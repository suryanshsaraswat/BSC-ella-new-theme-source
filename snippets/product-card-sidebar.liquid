{%- liquid
    assign product_swatch_option = settings.swatch | downcase
    assign isColor = false
    assign variant_img = ''
    for option in product_card_product.options_with_values
        assign option_name = option.name | downcase
        if product_swatch_option contains option_name
            assign isColor = true
            assign index = forloop.index0
            assign position = forloop.index | minus: 1
            assign variant_selected = option.selected_value
            for variant in product_card_product.variants limit: 1
                if variant.image != null
                    assign variant_img = variant.image
                endif
            endfor
          break
        else
            assign position = 0
            assign variant_selected = nil
        endif
    endfor
-%}
<div
  class="product-item product-item-custom{% if settings.disable_product_card_border %} disable_product_card_border{% endif %}{% if settings.enable_custom_layout_card %} enable_custom_layout_card{% endif %}{% if settings.disable_product_card_border and settings.enable_custom_layout_card %} enable_custom_content{% endif %}"
  data-product-id="product-{{ product_card_product.id }}"
  data-json-product='{{ product_card_product | json }}'>
  <div class="card">
    <div class="card-product{% if product_card_product.featured_media == nil %} card--text-only card--soft{% endif %}">
      <a class="card-media" href="{{ product_card_product.url | within: collection }}">
        {%- if product_card_product.featured_media -%}
          {%- if variant_img != blank -%}
            {% assign image = variant_img %}
          {%- else -%}
            {% assign image = product_card_product.images[0].src %}
          {%- endif -%}
          <img
            srcset="{{ image | img_url: '95x' }}"
            src="{{ image | img_url: '95x' }}"
            sizes="auto"
            alt="{{ image.alt | escape }}"
            loading="lazy"
            class="motion-reduce">
        {%- else -%}
          {% capture current %}
            {% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
          {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </a>
    </div>
    <div class="card-information">
      <div class="card-information__wrapper text-left">
        {%- if settings.show_reviews -%}
          <div class="card-review halo-productReview">
            <span class="shopify-product-reviews-badge" data-id="{{ product_card_product.id }}"></span>
          </div>
        {%- endif -%}
        <a class="card-title link-underline{% if settings.product_title_line_text != 'full' %} card-title-ellipsis{% endif %}{% if variant_selected != blank %} card-title-change{% endif %}" href="{{ product_card_product.url | within: collection }}">
          <span class="text">{{ product_card_product.title | escape }}{% if variant_selected != blank %}
              <span data-change-title>
                - {{ variant_selected }}</span>
            {% endif %}
          </span>
        </a>
        <div class="card-price">
          {% render 'price'
           , product: product_card_product,
           price_class: '' %}
        </div>
        {%- if settings.show_swatch and isColor -%}
          {% render 'product-swatch'
           , product: product_card_product,
           index: index %}
        {%- endif -%}
        <a class="card-button" href="{{ product_card_product.url | within: collection }}">{{ 'products.product.details' | t }}</a>
        <div class="card-action">
          <form
            action="{{ routes.cart_url }}/add"
            method="post"
            class="variants"
            id="{{ id }}-{{ product.id }}-{{ sectionId }}"
            data-product-id="{{ product.id }}"
            enctype="multipart/form-data">
            {%- if sold_out -%}
              {%- if settings.show_notify_form -%}
                <a
                  class="button button-ATC is-notify-me"
                  href="{{ product.url }}"
                  data-btn-addToCart>
                  {{ 'notify_form.general.label' | t }}
                </a>
              {%- else -%}
                <a
                  class="button button-ATC"
                  href="{{ product.url }}"
                  disabled="disabled">
                  {{ 'products.product.out_of_stock' | t }}
                </a>
              {%- endif -%}
            {%- else -%}
              {%- if variantCount > 0 and product.variants.first.title != 'Default Title' -%}
                {%- if product.options_with_values.size == 1 and product_swatch_option contains option_name and settings.show_swatch and settings.quick_shop_type == '1' -%}
                  <input
                    type="hidden"
                    name="id"
                    value="{{ product.variants[0].id }}" />
                  <input
                    type="hidden"
                    name="quantity"
                    value="1" />
                  <button
                    class="button button-ATC"
                    type="submit"
                    data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                    data-btn-addToCart>
                    {{ 'products.product.add_to_cart' | t }}
                  </button>
                {%- else -%}
                  <a class="button button-ATC" href="{{ product.url }}">
                    {{ 'products.product.select_options' | t }}
                  </a>
                {%- endif -%}
              {%- else -%}
                <input
                  type="hidden"
                  name="id"
                  value="{{ product.variants[0].id }}" />
                <input
                  type="hidden"
                  name="quantity"
                  value="1" />
                {%- liquid
                                        assign current_variant_grid = product.selected_or_first_available_variant
                                        assign first_inventory_grid = current_variant_grid.inventory_quantity
                                    -%}

                {%- if first_inventory_grid > 0 -%}
                  <button
                    class="button button-ATC"
                    type="submit"
                    data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                    data-btn-addToCart>
                    {{ 'products.product.add_to_cart' | t }}
                  </button>
                {%- else -%}
                  <button
                    class="button button-ATC"
                    type="submit"
                    data-form-id="#{{ id }}-{{ product.id }}-{{ sectionId }}"
                    data-btn-addToCart>
                    {{ 'products.product.pre_order' | t }}
                  </button>
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
